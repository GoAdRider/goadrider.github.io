<div class="language-switcher">
    <span class="lang-switch-title">{{ site.data.i18n[site.active_lang].lang_switcher.change_lang }}</span>
    <div class="lang-dropdown">
        <button id="langDropdownBtn" class="dropdown-btn">
            {% if site.active_lang == 'ko' %}
            <span class="lang-icon">ğŸ‡°ğŸ‡·</span>
            <span class="lang-text">í•œêµ­ì–´</span>
            {% else %}
            <span class="lang-icon">ğŸ‡ºğŸ‡¸</span>
            <span class="lang-text">English</span>
            {% endif %}
            <span class="dropdown-arrow">â–¼</span>
        </button>
        <div id="langDropdownContent" class="dropdown-content">
            {% assign ko_url = page.url %}
            {% assign en_url = page.url | prepend: '/en' %}

            {% if site.active_lang == 'en' %}
            {% assign ko_url = page.url | replace_first: '/en', '' %}
            {% if ko_url == '' %}
            {% assign ko_url = '/' %}
            {% endif %}
            {% endif %}

            <a href="{{ ko_url }}" class="{% if site.active_lang == 'ko' %}active{% endif %}" data-lang="ko">
                <span class="lang-icon">ğŸ‡°ğŸ‡·</span>
                <span class="lang-text">í•œêµ­ì–´</span>
            </a>
            <a href="{{ en_url }}" class="{% if site.active_lang == 'en' %}active{% endif %}" data-lang="en">
                <span class="lang-icon">ğŸ‡ºğŸ‡¸</span>
                <span class="lang-text">English</span>
            </a>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // ì–¸ì–´ ì „í™˜ ë“œë¡­ë‹¤ìš´ í† ê¸€ ì²˜ë¦¬
        const dropdownBtn = document.getElementById('langDropdownBtn');
        const dropdownContent = document.getElementById('langDropdownContent');

        if (dropdownBtn) {
            dropdownBtn.addEventListener('click', function (e) {
                e.preventDefault();
                e.stopPropagation();
                dropdownContent.classList.toggle('show');
            });
        }

        // ë¬¸ì„œ í´ë¦­ ì‹œ ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
        document.addEventListener('click', function (e) {
            if (!e.target.closest('.language-switcher')) {
                if (dropdownContent && dropdownContent.classList.contains('show')) {
                    dropdownContent.classList.remove('show');
                }
            }
        });

        // ì–¸ì–´ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
        const langButtons = document.querySelectorAll('.dropdown-content a');
        if (langButtons) {
            langButtons.forEach(function (btn) {
                btn.addEventListener('click', function (e) {
                    // ì–¸ì–´ ë³€ê²½ ì‹œ ì¿ í‚¤ ì €ì¥
                    const lang = this.getAttribute('data-lang');
                    document.cookie = `preferred_lang=${lang}; path=/; max-age=31536000; SameSite=Lax`;

                    // ì‚¬ìš©ì ì •ì˜ ì´ë²¤íŠ¸ ë°œìƒ
                    const event = new CustomEvent('languageChanged', { detail: { language: lang } });
                    document.dispatchEvent(event);
                });
            });
        }

        // í˜„ì¬ ì–¸ì–´ì— ê¸°ë°˜í•˜ì—¬ HTML lang ì†ì„± ì„¤ì •
        const currentLang = document.querySelector('.dropdown-content a.active');
        if (currentLang) {
            const lang = currentLang.getAttribute('data-lang');
            document.documentElement.setAttribute('lang', lang);
        }
    });
</script>

<style>
    .language-switcher {
        position: relative;
        display: inline-flex;
        flex-direction: column;
        align-items: flex-end;
        margin: 0 1rem;
    }

    .lang-switch-title {
        font-size: 0.8rem;
        margin-bottom: 0.25rem;
        color: #666;
    }

    .lang-dropdown {
        position: relative;
    }

    .dropdown-btn {
        display: flex;
        align-items: center;
        padding: 0.25rem 0.5rem;
        text-decoration: none;
        color: #333;
        background-color: #f5f5f5;
        transition: background-color 0.2s;
        font-size: 0.85rem;
    }

    .dropdown-btn:hover {
        background-color: #e0e0e0;
        text-decoration: none;
    }

    .dropdown-content {
        display: none;
        position: absolute;
        background-color: #f9f9f9;
        min-width: 160px;
        box-shadow: 0px 8px 16px 0px rgba(0, 0, 0, 0.2);
        z-index: 1;
    }

    .dropdown-content a {
        color: black;
        padding: 12px 16px;
        text-decoration: none;
        display: block;
    }

    .dropdown-content a:hover {
        background-color: #f1f1f1;
    }

    .lang-icon {
        margin-right: 5px;
    }

    @media (max-width: 767px) {
        .lang-text {
            display: none;
        }

        .dropdown-btn {
            padding: 0.25rem;
        }

        .lang-icon {
            margin-right: 0;
        }
    }
</style>