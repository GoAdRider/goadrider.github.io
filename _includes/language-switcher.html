<div class="language-switcher">
    <span class="lang-switch-title">{{ site.data.i18n[site.active_lang].lang_switcher.change_lang }}</span>
    <div class="lang-switch-buttons">
        <a href="{{ site.baseurl_root }}{{ page.url }}"
            class="lang-btn {% if site.active_lang == 'ko' %}active{% endif %}" data-lang="ko">
            <span class="lang-icon">🇰🇷</span>
            <span class="lang-text">한국어</span>
        </a>
        <a href="{{ site.baseurl_root }}/en{{ page.url }}"
            class="lang-btn {% if site.active_lang == 'en' %}active{% endif %}" data-lang="en">
            <span class="lang-icon">🇺🇸</span>
            <span class="lang-text">English</span>
        </a>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // 언어 변경 시 필요한 처리
        const languageSwitcher = document.querySelector('.language-switcher');
        const langButtons = document.querySelectorAll('.lang-btn');

        if (langButtons) {
            langButtons.forEach(function (btn) {
                btn.addEventListener('click', function (e) {
                    // 언어 변경 시 쿠키 저장
                    const lang = this.getAttribute('data-lang');
                    document.cookie = `preferred_lang=${lang}; path=/; max-age=31536000; SameSite=Lax`;

                    // 사용자 정의 이벤트 발생
                    const event = new CustomEvent('languageChanged', { detail: { language: lang } });
                    document.dispatchEvent(event);
                });
            });
        }

        // 현재 언어에 기반하여 HTML lang 속성 설정
        const currentLang = document.querySelector('.lang-btn.active');
        if (currentLang) {
            const lang = currentLang.getAttribute('data-lang');
            document.documentElement.setAttribute('lang', lang);
        }
    });
</script>

<style>
    .language-switcher {
        position: relative;
        display: inline-flex;
        flex-direction: column;
        align-items: flex-end;
        margin: 0 1rem;
    }

    .lang-switch-title {
        font-size: 0.8rem;
        margin-bottom: 0.25rem;
        color: #666;
    }

    .lang-switch-buttons {
        display: flex;
        border-radius: 4px;
        overflow: hidden;
        border: 1px solid #e0e0e0;
    }

    .lang-btn {
        display: flex;
        align-items: center;
        padding: 0.25rem 0.5rem;
        text-decoration: none;
        color: #333;
        background-color: #f5f5f5;
        transition: background-color 0.2s;
        font-size: 0.85rem;
    }

    .lang-btn:hover {
        background-color: #e0e0e0;
        text-decoration: none;
    }

    .lang-btn.active {
        background-color: #336699;
        color: white;
    }

    .lang-icon {
        margin-right: 5px;
    }

    @media (max-width: 767px) {
        .lang-text {
            display: none;
        }

        .lang-btn {
            padding: 0.25rem;
        }

        .lang-icon {
            margin-right: 0;
        }
    }
</style>