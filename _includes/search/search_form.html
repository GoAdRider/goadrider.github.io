{% if site.search == true %}
<div class="search-content__inner-wrap">
    <div class="search-form-container">
        <form class="search-form" action="{{ site.baseurl }}/search/" method="get">
            <label class="sr-only" for="search">{{ site.data.ui-text[site.locale].search_label_text | default: 'Enter
                your search term...' }}</label>
            <div class="search-input-container">
                <input type="search" id="search"
                    aria-placeholder="{{ site.data.ui-text[site.locale].search_placeholder_text | default: 'Enter your search term...' }}"
                    placeholder="{{ site.data.ui-text[site.locale].search_placeholder_text | default: 'Enter your search term...' }}"
                    name="q" />
                <button type="submit" class="search-submit">
                    <i class="fas fa-search" aria-hidden="true"></i><span class="sr-only">{{
                        site.data.ui-text[site.locale].search_label | default: "Search" }}</span>
                </button>
            </div>
        </form>
    </div>

    <!-- 검색 로딩 표시 -->
    <div id="search-loading" class="search-loading" style="display: none;">
        <div class="search-loading__spinner">
            <i class="fas fa-spinner fa-pulse fa-3x fa-fw"></i>
            <span class="sr-only">{{ site.data.ui-text[site.locale].loading_label | default: "Loading..." }}</span>
        </div>
    </div>

    <!-- 검색 오류 메시지 -->
    <div id="search-error" class="search-error" style="display: none;">
        <i class="fas fa-exclamation-triangle"></i>
        <span class="search-error-text">검색 기능을 로드하는 중 오류가 발생했습니다.</span>
        <button onClick="window.debugSearch().reload()" class="search-retry">
            <i class="fas fa-redo"></i> 다시 시도
        </button>
    </div>

    <!-- 검색 결과 영역 -->
    <div id="results" class="results"></div>

    <!-- 검색 팁 -->
    <div class="search-tips">
        <h4 class="search-tips__title">
            {% if site.locale == "ko" %}
            검색 도움말
            {% else %}
            Search Tips
            {% endif %}
        </h4>
        <ul class="search-tips__list">
            {% if site.locale == "ko" %}
            <li>정확한 단어나 문구로 검색하세요.</li>
            <li>단어 사이에 공백을 넣어 여러 키워드로 검색할 수 있습니다.</li>
            <li>너무 일반적인 단어는 검색 결과가 너무 많을 수 있습니다.</li>
            {% else %}
            <li>Search with exact words or phrases.</li>
            <li>Use space between words to search for multiple keywords.</li>
            <li>Common words may yield too many results.</li>
            {% endif %}
        </ul>
    </div>
</div>

<style>
    /* 검색 폼 레이아웃과 스타일 */
    .search-content__inner-wrap {
        max-width: 100%;
        padding: 1em;
    }

    .search-form-container {
        margin-bottom: 1.5em;
    }

    .search-form {
        position: relative;
    }

    .search-input-container {
        display: flex;
        align-items: center;
    }

    #search {
        flex: 1;
        padding: 0.5em 1em;
        border: 1px solid #ccc;
        border-radius: 4px;
        font-size: 1em;
        box-sizing: border-box;
        width: 100%;
    }

    .search-submit {
        background: transparent;
        border: none;
        margin-left: -40px;
        color: #666;
        font-size: 1.2em;
        cursor: pointer;
        padding: 0.5em;
    }

    .search-submit:hover {
        color: #333;
    }

    /* 로딩 인디케이터 */
    .search-loading {
        text-align: center;
        padding: 2em;
    }

    .search-loading__spinner {
        color: #666;
    }

    /* 에러 메시지 */
    .search-error {
        text-align: center;
        padding: 1em;
        margin: 1em 0;
        background-color: #ffecec;
        border: 1px solid #f5aca6;
        border-radius: 4px;
        color: #cc0033;
    }

    .search-error i {
        margin-right: 0.5em;
    }

    .search-retry {
        background: #f0f0f0;
        border: 1px solid #ddd;
        border-radius: 4px;
        padding: 0.3em 0.8em;
        margin-left: 1em;
        cursor: pointer;
        font-size: 0.9em;
    }

    .search-retry:hover {
        background: #e0e0e0;
    }

    /* 검색 결과 스타일 */
    .results {
        margin-top: 1em;
    }

    .results__found {
        margin-bottom: 1em;
        padding-bottom: 0.5em;
        border-bottom: 1px solid #eee;
        font-weight: bold;
    }

    .list__item {
        margin-bottom: 2em;
        padding-bottom: 1em;
        border-bottom: 1px solid #f2f2f2;
    }

    .archive__item-title {
        margin-top: 0;
        margin-bottom: 0.5em;
        font-size: 1.2em;
    }

    .archive__item-excerpt {
        margin-top: 0.5em;
        margin-bottom: 0;
        font-size: 0.9em;
        color: #666;
    }

    /* 검색 팁 */
    .search-tips {
        margin-top: 2em;
        padding: 1em;
        background-color: #f9f9f9;
        border: 1px solid #eee;
        border-radius: 4px;
    }

    .search-tips__title {
        margin-top: 0;
        margin-bottom: 0.8em;
        font-size: 1em;
        color: #333;
    }

    .search-tips__list {
        margin: 0;
        padding-left: 1.2em;
    }

    .search-tips__list li {
        margin-bottom: 0.5em;
        font-size: 0.9em;
        color: #666;
    }

    /* 반응형 조정 */
    @media screen and (max-width: 768px) {
        .search-content__inner-wrap {
            padding: 0.5em;
        }

        #search {
            padding: 0.4em 0.8em;
            font-size: 0.9em;
        }

        .search-tips {
            padding: 0.8em;
        }
    }
</style>

<script>
    // 페이지 로드 시 초기화
    document.addEventListener('DOMContentLoaded', function () {
        var searchInput = document.getElementById('search');
        var resultsContainer = document.getElementById('results');

        // URL에서 쿼리 파라미터 가져오기
        var urlParams = new URLSearchParams(window.location.search);
        var query = urlParams.get('q');

        // 쿼리 파라미터가 있으면 입력 필드에 설정
        if (query) {
            searchInput.value = query;

            // 검색 데이터가 이미 로드되었는지 확인하고 그에 따라 처리
            if (window.store && window.store.length > 0) {
                // 이미 데이터가 로드됨 - 검색 실행 가능
                // lunr.js 스크립트가 로드되면 자동으로 검색 실행됨
            } else {
                // 데이터가 아직 로드되지 않음 - 로딩 표시
                document.getElementById('search-loading').style.display = 'block';
            }
        }

        // 폼 제출 처리 
        document.querySelector('.search-form').addEventListener('submit', function (e) {
            var q = searchInput.value.trim();

            // 검색어가 없으면 제출 취소
            if (!q) {
                e.preventDefault();
            }
        });
    });
</script>
{% endif %}