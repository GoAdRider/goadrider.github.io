<!-- 포스트 내 언어 전환 스크립트 - 단순화된 버전 -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        console.log('[💡 포스트 레이아웃] 언어 전환 초기화');

        // DOM 요소 교체 방식의 언어 전환 함수
        function forceLanguageSwitch() {
            // 현재 언어 확인 및 로깅
            const lang = localStorage.getItem('lang') || 'ko';
            console.log('[💡 포스트 레이아웃] 언어 전환:', lang);

            try {
                // 1. 가장 간단한 접근법 - 직접 스타일시트 삽입
                const styleId = 'language-switch-styles';
                let styleEl = document.getElementById(styleId);

                if (!styleEl) {
                    styleEl = document.createElement('style');
                    styleEl.id = styleId;
                    document.head.appendChild(styleEl);
                }

                // 아주 강력한 CSS 규칙 추가 (모든 다른 스타일을 덮어씀)
                if (lang === 'ko') {
                    styleEl.innerHTML = `
                        .post-content-ko { display: block !important; visibility: visible !important; opacity: 1 !important; }
                        .post-content-en { display: none !important; visibility: hidden !important; opacity: 0 !important; }
                    `;
                    console.log('[💡 포스트 레이아웃] 한국어 모드 스타일 적용');
                } else {
                    styleEl.innerHTML = `
                        .post-content-ko { display: none !important; visibility: hidden !important; opacity: 0 !important; }
                        .post-content-en { display: block !important; visibility: visible !important; opacity: 1 !important; }
                    `;
                    console.log('[💡 포스트 레이아웃] 영어 모드 스타일 적용');
                }

                // 2. 직접 DOM 요소 수정 (백업 메커니즘)
                console.log('[💡 포스트 레이아웃] 본문 요소 직접 조작 시작');

                // 여러 방법으로 요소 찾기 시도
                const koContents = document.querySelectorAll('.post-content-ko');
                const enContents = document.querySelectorAll('.post-content-en');

                console.log('[💡 포스트 레이아웃] 찾은 요소:', {
                    '한국어': koContents.length,
                    '영어': enContents.length
                });

                // 직접 인라인 스타일 적용 (가장 우선순위 높음)
                if (lang === 'ko') {
                    koContents.forEach(el => {
                        console.log('[💡 포스트 레이아웃] 한국어 요소 표시:', el);
                        el.style.setProperty('display', 'block', 'important');
                        el.style.setProperty('visibility', 'visible', 'important');
                        el.style.setProperty('opacity', '1', 'important');
                    });

                    enContents.forEach(el => {
                        console.log('[💡 포스트 레이아웃] 영어 요소 숨김:', el);
                        el.style.setProperty('display', 'none', 'important');
                        el.style.setProperty('visibility', 'hidden', 'important');
                        el.style.setProperty('opacity', '0', 'important');
                    });
                } else {
                    koContents.forEach(el => {
                        console.log('[�� 포스트 레이아웃] 한국어 요소 숨김:', el);
                        el.style.setProperty('display', 'none', 'important');
                        el.style.setProperty('visibility', 'hidden', 'important');
                        el.style.setProperty('opacity', '0', 'important');
                    });

                    enContents.forEach(el => {
                        console.log('[💡 포스트 레이아웃] 영어 요소 표시:', el);
                        el.style.setProperty('display', 'block', 'important');
                        el.style.setProperty('visibility', 'visible', 'important');
                        el.style.setProperty('opacity', '1', 'important');
                    });
                }

                // 추가 디버깅 - 요소 속성 출력
                if (koContents.length > 0) {
                    console.log('[💡 포스트 레이아웃] 한국어 요소 클래스:', koContents[0].className);
                    console.log('[💡 포스트 레이아웃] 한국어 요소 HTML:', koContents[0].outerHTML.substring(0, 100) + '...');
                }

                if (enContents.length > 0) {
                    console.log('[💡 포스트 레이아웃] 영어 요소 클래스:', enContents[0].className);
                    console.log('[💡 포스트 레이아웃] 영어 요소 HTML:', enContents[0].outerHTML.substring(0, 100) + '...');
                }

                // 3. 다른 언어 요소들 (카테고리, 태그 등) 업데이트
                document.querySelectorAll('[data-ko][data-en]').forEach(el => {
                    el.textContent = lang === 'ko' ? el.getAttribute('data-ko') : el.getAttribute('data-en');
                });

                // 4. 카테고리/태그 특별 처리
                document.querySelectorAll('.post-categories .category-link span, .post-tags .tag-text').forEach(el => {
                    if (el.hasAttribute('data-ko') && el.hasAttribute('data-en')) {
                        el.textContent = lang === 'ko' ? el.getAttribute('data-ko') : el.getAttribute('data-en');
                    }
                });

                console.log('[💡 포스트 레이아웃] 모든 요소 전환 완료');

                // DOM 업데이트가 반영되도록 강제
                document.body.offsetHeight;
            } catch (err) {
                console.error('[💡 포스트 레이아웃] 오류 발생:', err);
            }
        }

        // 첫 실행은 즉시
        forceLanguageSwitch();

        // 언어 변경 이벤트 리스너 (다양한 방식으로 변경 감지)
        document.addEventListener('languageChanged', function () {
            console.log('[💡 포스트 레이아웃] 이벤트 감지');
            forceLanguageSwitch();
        });

        // 로컬 스토리지 직접 감시
        window.addEventListener('storage', function (e) {
            if (e.key === 'lang') {
                console.log('[💡 포스트 레이아웃] 스토리지 변경 감지:', e.newValue);
                forceLanguageSwitch();
            }
        });

        // 토글 버튼 직접 감시
        document.getElementById('language-toggle')?.addEventListener('click', function () {
            console.log('[💡 포스트 레이아웃] 버튼 클릭 감지');
            setTimeout(forceLanguageSwitch, 100);
        });

        // 안전 장치: 지연 실행으로 다른 스크립트 간섭 방지
        setTimeout(forceLanguageSwitch, 500);
        setTimeout(forceLanguageSwitch, 1000);
    });
</script>